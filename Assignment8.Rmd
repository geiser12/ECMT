---
title: "Assignment 8"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
First, I need to load in the necessary libraries and the data.

```{r message=FALSE, warning=FALSE}
#load libraries
library(tidyverse)
library(ggplot2)
library(quantmod)
library(Quandl)

#read in the data from fred
#first data set is the real GPD growth
#second data set loaded in will be:
#10-Year Treasury Constant Maturity Minus 2-Year Treasury Constant Maturity
Quandl.api_key("Bsjtos3Rumnys9NRFspt")

#import the dataset
hw8 <- Quandl(c('FRED/GDPC1','FRED/T10Y2Y'), collapse='quarterly', type="xts")

# Rename the variables
names(hw8)[1] <- "rgdp"
names(hw8)[2] <- "spread"
sum(with(hw8, is.na(rgdp)))
sum(with(hw8, is.na(spread)))
hw8 <- na.omit(hw7)  # 1976 Q2 ~ 2021 Q3

# Simple definition of growth rate vs. log-difference approximation
ld_rgdp <- na.exclude(diff(log(hw8$rgdp))  * 100)
T = dim(hw8)[1]
spread <- hw8[2:T,2]

#create the subsample
sub_sample_reg <- lm(window(ld_rgdp, end = "2011-12-31") ~ window(spread,end = "2011-12-31"))
summary(sub_sample_reg)
sub_sample_mean <- lm(window(ld_rgdp, end = "2011-12-31") ~ 1)

#create the data that will be used for the loop
m2_ld_rgdp = window(ld_rgdp, end = "2011-12-31")
m2_spread = window(spread, end = "2011-12-31")
T2 = dim(m2_ld_rgdp)[1]
```
create a direct prediction model. modify from q4 onwards - do everything up to q4 the same. modify line 157 for the lead and lag values - same line from above copied down. output is one period ahead of the spread. so change the gdp of the dataset to one period later at the beginning and the spread is one period before on the ending values. then use line 162 to actually predict. this is for the second equation on the homework. do over for h=4 and h=8
```{r}
#create equation 2
oos_predict_1s = sub_sample_reg$coef[1] + sub_sample_reg$coef[2]*window(spread, start = "2012-01-31", end = "2019-12-31")
oos_predict_2s = sub_sample_mean$coef[1] + 0*window(spread, start = "2011-12-31", end = "2019-09-30")

index(oos_predict_1s) = index(oos_predict_2s)

realization_s = window(ld_rgdp, start = "2012-01-31", end = "2019-12-31")

fe1 = realization_s-oos_predict_1s
fe2 = realization_s-oos_predict_2s

MSFE = c(mean(fe1^2), mean(fe2^2))
```
equation 1
```{r}
#create a loop to check with equation 2
for (h in c(1,4,8)){
  reg = lm(m2_ld_rgdp[(h+1):T2,]-m2_spread[1:(T2-h)])
  cat('current forecasting horizon', h)
  print(summary(reg))
}

#equation 1 loop
for (h in c(1,4,8)){
  csum_ld_rgdp = 0*m2_ld_rdgp
  for (i in (1:(T2-h))){
    csum_ld_rgdp[i,] =sum(m2_ld_rdgp[i+1:(i+h),])
  }
  cat("Current Forecsting horizon: ", h)
  print(cbind(head(m2_ld_rdgp,10),head(csum_ld_rgdp,10)))
  reg = lm(csum_ld_rgdp[1:(t=T2-h),]/h-m2_spread[1:(T2-h),])
  print(summary(reg))
  print(coeftest(reg, vcov. = Neweywest(reg, lag = round(0.75*T2^(1/3)))))
}
```

